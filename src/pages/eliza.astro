---
import settings from '@base/settings.json';
import ElizaModule from '@components/AgentsUI';
import BaseHtml from '@layouts/BaseHtml.astro';
import { isClient } from '@utils/common';
import { getCookie } from '@utils/cookies';

declare global {
  interface Window {
    promotekit_referral: string;
  }
}

const getReferralIdFromCookie = () => {
  try {
     const promotekit_referral = getCookie('promotekit_referral');

    if (!promotekit_referral) throw Error('Promotekit referral cookie was not found!');

    return promotekit_referral;
  } catch (_err) {
    console.warn(
      `Promotekit referral cookie is not set`,
    );

    return '';
  }
}

const getReferralId = () => {
  try {
    return window.promotekit_referral;
  } catch (_err) {
    console.warn(
      `Expected a promotekit_referral but got ${typeof window.promotekit_referral}. Will try cookie!`,
    );
    return getReferralIdFromCookie();
  }
};
---

<BaseHtml
  title={settings.site.metadata.eliza.title}
  ogMeta={{
    title: settings.site.metadata.eliza.title,
    description: settings.site.metadata.eliza.description,
    image: settings.site.metadata.eliza.image,
    slug: settings.site.metadata.eliza.slug,
  }}
  overflowHorizontally
>
  <ElizaModule
    client:load
    getReferralId={getReferralId}
  />
</BaseHtml>
