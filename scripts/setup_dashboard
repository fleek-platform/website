#!/bin/bash

ENV="$1"
TARGET_PATH="$2"

if [[ -z "$ENV" || -z "$TARGET_PATH" ]]; then
  echo "ðŸ‘¹ Oops! Missing environment variable"
  exit 1
fi

tag="prerelease"
packageName="@fleek-platform/dashboard"
sourcePath="node_modules/@fleek-platform/agents-ui/dist/"
targetPath="$TARGET_PATH"

if [[ "$TARGET_ENVIRONMENT" == 'production' ]]; then
  tag="latest"
fi

if ! npm i --no-save "$packageName@$tag"; then
  echo "ðŸ‘¹ Oops! Failed to install the $packageName of tag $tag for some reason..."

  exit 1
fi

if [[ ! -d "$targetPath" ]]; then
  echo "ðŸ¤– Should create $targetPath"
  if ! mkdir -p "$targetPath"; then
    echo "ðŸ‘¹ Oops! Failed to create directory $targetPath..."
    exit 1
  else
    echo "âœ… Successfully created directory $targetPath"
  fi
else
  echo "âœ… Directory $targetPath already exists"
fi

cp -r "$sourcePath" "$targetPath"
